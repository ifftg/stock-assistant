# 新版PRD：智能股票分析平台（最终可实现版）

**版本**: 4.0 (最终重构版)
**日期**: 2025-09-02
**目标**: 构建一个真正可实现的个人投资者智能分析助手

## 🎯 **项目定位与愿景**

### **核心定位**
我们是：**个人投资者的智能分析助手**
我们不是：专业交易系统或投资顾问

### **目标用户**
- 个人投资者（非专业交易员）
- 希望降低投资分析门槛的用户
- 需要AI辅助决策支持的散户

### **核心价值**
1. 降低个人投资者的分析门槛
2. 提供AI辅助的投资决策支持
3. 整合分散的投资信息和工具
4. 现代化的用户体验

### **技术边界明确定义**

#### ✅ **我们能做的**
- 日线级策略筛选（基于收盘数据）
- 基础技术指标分析（MACD、KDJ、RSI等）
- 简单策略回测（经典策略验证）
- AI辅助分析（基于基本面数据）
- 个人投资决策支持工具

#### ❌ **我们做不了的**
- 毫秒级高频交易（成本过高，需专业设备）
- Level-2深度行情分析（数据成本月费数万）
- 复杂多因子模型（需要专业量化团队）
- 实时风险控制系统（需要金融牌照）
- 代客理财功能（法律限制）

## 🏗️ **核心架构设计**

### **数据流架构**
```
东方财富API → 定时预处理 → Supabase数据库 → 前端秒级查询
```

### **技术栈**
- **前端**: Next.js 14 + TypeScript + Tailwind CSS + shadcn/ui
- **后端**: Supabase (PostgreSQL + Edge Functions + Auth)
- **数据源**: 东方财富API (免费、稳定，15分钟延迟)
- **AI**: Google Gemini Pro (通过Supabase Edge Function)
- **图表**: Apache ECharts for React
- **部署**: Vercel + GitHub CI/CD

### **开发环境策略**
- **前端开发**: 本地 Next.js 开发服务器（快速调试）
- **后端测试**: 直接在 Vercel + Supabase 环境（避免本地API不稳定）
- **数据调试**: 使用 Vercel 预览部署功能
- **最终测试**: 生产环境验证

## 📊 **数据架构设计**

### **市场范围**
- **A股**: ~5000只股票
- **B股**: ~100只股票
- **总计**: ~5100只股票
- **数据精度**: 日线级别（15分钟延迟可接受）

### **数据需求分级分析**

#### **场景1：个股分析**
```
数据要求：
- 实时性：中等（15分钟延迟可接受）
- 历史深度：1-2年日线数据
- 指标需求：基础技术指标（MACD、KDJ、RSI等）

我们能做到：✅ 完全可以
- 东方财富API提供充足数据
- 技术指标可以实时计算
- AI分析基于基本面数据
```

#### **场景2：策略筛选**
```
数据要求：
- 实时性：低（日线数据即可）
- 覆盖面：全市场5000+股票
- 计算量：大（需要批量处理）

我们能做到：✅ 可以，但有限制
- 可以做日线级别的策略筛选
- 无法做分钟级高频策略
- 适合中长线投资策略
```

#### **场景3：量化策略回测**
```
数据要求：
- 实时性：无要求（历史数据）
- 历史深度：3-5年
- 数据质量：高（需要复权、分红数据）

我们能做到：⚠️ 部分可以
- 可以做简单策略回测
- 无法做复杂的多因子模型
- 适合经典策略验证
```

### **数据表设计**

```sql
-- 1. 股票基础信息表
CREATE TABLE stocks_info (
  ticker VARCHAR(10) PRIMARY KEY,
  name VARCHAR(50) NOT NULL,
  market VARCHAR(10), -- 'A股' 或 'B股'
  industry VARCHAR(50),
  list_date DATE,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 2. 每日股票数据表（热数据，30天）
CREATE TABLE stocks_daily (
  id SERIAL PRIMARY KEY,
  ticker VARCHAR(10) NOT NULL,
  trade_date DATE NOT NULL,
  open_price DECIMAL(10,3),
  close_price DECIMAL(10,3),
  high_price DECIMAL(10,3),
  low_price DECIMAL(10,3),
  volume BIGINT,
  turnover DECIMAL(15,2),
  pe_ratio DECIMAL(8,2),
  pb_ratio DECIMAL(8,2),
  market_cap BIGINT,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(ticker, trade_date)
);

-- 3. 用户自选股表
CREATE TABLE watchlists (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  ticker VARCHAR(10) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, ticker)
);

-- 4. AI分析记录表（含次数限制）
CREATE TABLE ai_analyses (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  ticker VARCHAR(10) NOT NULL,
  analysis_text TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 5. 市场指数数据表（新增）
CREATE TABLE market_indices (
  id SERIAL PRIMARY KEY,
  index_code VARCHAR(10) NOT NULL, -- 'sh000001', 'sz399001', 'sz399006'
  index_name VARCHAR(20) NOT NULL, -- '上证指数', '深证成指', '创业板指'
  current_price DECIMAL(10,3),
  change_amount DECIMAL(10,3),
  change_percent DECIMAL(8,4),
  volume BIGINT,
  turnover DECIMAL(15,2),
  update_time TIMESTAMP DEFAULT NOW(),
  UNIQUE(index_code, DATE(update_time))
);

-- 6. 财经新闻表（新增）
CREATE TABLE financial_news (
  id SERIAL PRIMARY KEY,
  title VARCHAR(200) NOT NULL,
  summary TEXT,
  source VARCHAR(50),
  url VARCHAR(500),
  publish_time TIMESTAMP,
  category VARCHAR(20), -- '公告', '新闻', '政策', '研报'
  importance_level INTEGER DEFAULT 1, -- 1-5重要程度
  created_at TIMESTAMP DEFAULT NOW()
);

-- 7. 概念板块数据表（新增）
CREATE TABLE concept_sectors (
  id SERIAL PRIMARY KEY,
  sector_name VARCHAR(50) NOT NULL,
  sector_code VARCHAR(20),
  change_percent DECIMAL(8,4),
  leading_stock VARCHAR(10), -- 龙头股票代码
  stock_count INTEGER, -- 板块内股票数量
  update_time TIMESTAMP DEFAULT NOW(),
  UNIQUE(sector_code, DATE(update_time))
);
```

## 🔐 **用户认证系统**

### **注册登录设计**
```
注册方式：
1. 邮箱注册（主要方式）
2. 手机号注册（备选方式）
3. 第三方登录（GitHub、Google）

验证机制：
- 邮箱验证码确认
- 密码强度检查（8位以上，包含数字字母）
- 防机器人验证（reCAPTCHA）

用户权限分级：
- 免费用户：AI分析5次/日，基础功能
- 付费用户：AI分析无限制，高级功能
```

### **Supabase Auth集成**
```typescript
// 用户注册
const { data, error } = await supabase.auth.signUp({
  email: 'user@example.com',
  password: 'password123',
  options: {
    emailRedirectTo: 'https://yourapp.com/welcome'
  }
})

// 用户登录
const { data, error } = await supabase.auth.signInWithPassword({
  email: 'user@example.com',
  password: 'password123'
})

// 第三方登录
const { data, error } = await supabase.auth.signInWithOAuth({
  provider: 'github'
})
```

## 🎨 **UI/UX设计方案**

### **整体视觉风格**
```
设计主题：科技金融风格
- 深色背景：主色#0a0e1a，辅色#1a1f2e
- 粒子流背景：动态科技感粒子流动画
- 渐变配色：蓝紫渐变#00d4ff → #9c27b0
- 玻璃拟态：backdrop-filter模糊效果
- 发光效果：按钮和边框发光阴影
- 字体：现代无衬线字体（Inter、SF Pro）
```

### **响应式布局架构**

#### **桌面端布局（≥1200px）- 大气现代化设计**
```
┌─────────────────────────────────────────────────────────────────────┐
│  Logo [大字体]     导航菜单 [宽松间距]           用户头像  登录/注册    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│                        首页：市场行情全景展示                        │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │                     大盘指数仪表盘                               │ │
│  │  上证指数 3,234.56 ↗ +1.23%    深证成指 12,345.67 ↗ +0.89%    │ │
│  │  [大字体显示，醒目颜色，实时动画]                                │ │
│  ├─────────────────────────────────────────────────────────────────┤ │
│  │                                                                 │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │ │
│  │  │   涨幅排行榜     │  │   成交量排行     │  │   热门板块      │  │ │
│  │  │  [大卡片设计]   │  │  [大卡片设计]   │  │  [大卡片设计]   │  │ │
│  │  │                 │  │                 │  │                 │  │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘  │ │
│  │                                                                 │ │
│  ├─────────────────────────────────────────────────────────────────┤ │
│  │                        财经资讯流                               │ │
│  │  [新闻卡片，宽松布局，大字体标题]                                │ │
│  └─────────────────────────────────────────────────────────────────┘ │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

其他板块布局：
┌─────────────────────────────────────────────────────────────────────┐
│                           顶部导航栏                                │
├─────────────┬───────────────────────────────────────────────────────┤
│             │                                                     │
│   左侧导航   │                  主内容区                            │
│             │                                                     │
│  �市场行情  │  ┌─────────────────┬─────────────────────────────────┐ │
│  🎯策略选股  │  │                 │                                 │ │
│  🔍个股分析  │  │   主要功能区     │        辅助信息区                │ │
│  ⚡量化工作台 │  │  [大卡片布局]   │       [大卡片布局]              │ │
│  💼交易系统  │  │                 │                                 │ │
│             │  ├─────────────────┴─────────────────────────────────┤ │
│             │  │                                                   │ │
│             │  │              扩展功能区                            │ │
│             │  │             [全宽度展示]                           │ │
│             │  │                                                   │ │
│             │  └───────────────────────────────────────────────────┘ │
└─────────────┴───────────────────────────────────────────────────────┘
```

#### **平板端布局（768px-1199px）- 保持大气感**
```
┌─────────────────────────────────────────────────────────┐
│  Logo [适中字体]    导航菜单           用户头像  登录     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│                    主内容区                              │
│  ┌─────────────────────────────────────────────────────┐ │
│  │                 大盘指数展示                         │ │
│  │              [保持大字体显示]                        │ │
│  ├─────────────────────────────────────────────────────┤ │
│  │                                                     │ │
│  │  ┌─────────────────┐    ┌─────────────────────────┐  │ │
│  │  │   主要功能区     │    │      辅助功能区          │  │ │
│  │  │  [适度压缩]     │    │     [适度压缩]          │  │ │
│  │  └─────────────────┘    └─────────────────────────┘  │ │
│  │                                                     │ │
│  ├─────────────────────────────────────────────────────┤ │
│  │                 扩展信息区                           │ │
│  │               [全宽度展示]                           │ │
│  └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

#### **移动端布局（<768px）- 垂直大气布局**
```
┌─────────────────────────────────┐
│  Logo [大字体]    ☰  用户头像    │
├─────────────────────────────────┤
│                                 │
│           主内容区               │
│        [垂直堆叠，大间距]        │
│                                 │
│  ┌─────────────────────────────┐ │
│  │        大盘指数              │ │
│  │     [大字体保持]            │ │
│  └─────────────────────────────┘ │
│                                 │
│  ┌─────────────────────────────┐ │
│  │        功能卡片1            │ │
│  │     [大尺寸卡片]            │ │
│  └─────────────────────────────┘ │
│                                 │
│  ┌─────────────────────────────┐ │
│  │        功能卡片2            │ │
│  │     [大尺寸卡片]            │ │
│  └─────────────────────────────┘ │
│                                 │
├─────────────────────────────────┤
│ 🏠  🎯  🔍  ⚡  💼              │
│      底部导航栏                  │
│   [大图标，清晰标签]            │
└─────────────────────────────────┘
```

### **粒子流背景技术实现**
```css
/* 主背景 */
.particle-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  background: linear-gradient(135deg, #0a0e1a 0%, #1a1f2e 100%);
}

/* 玻璃拟态卡片 */
.glass-card {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

/* 发光按钮效果 */
.glow-button {
  background: linear-gradient(45deg, #00d4ff, #9c27b0);
  box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
  transition: all 0.3s ease;
}

.glow-button:hover {
  box-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
  transform: translateY(-2px);
}
```

## 🎨 **功能模块设计（五板块架构）**

### **板块1: 综合市场行情（首页）**
**位置**: 首页主展示区域，用户进入后的第一视觉焦点
**设计理念**: 大气磅礴的市场全景展示，现代化金融科技风格

**核心功能**:
```
🌟 大盘指数仪表盘：
- 上证指数、深证成指、创业板指
- 大字体显示当前点位，醒目的涨跌颜色
- 实时涨跌幅、成交量、成交额
- 动态图表展示日内走势

📈 市场热力图：
- 涨跌幅排行榜（前10涨幅、跌幅股票）
- 成交量排行榜（最活跃股票）
- 热门概念板块热力图
- 市场情绪指标可视化

📰 财经资讯流：
- 重要公告滚动展示
- 市场热点新闻卡片
- 政策解读快讯
- 机构观点摘要
```

**视觉设计**:
```
大气布局：
- 全屏宽度的指数展示区（类似Bloomberg终端）
- 卡片式信息模块，间距宽松
- 大字体、高对比度的数据展示
- 动态数据更新动画效果

科技感元素：
- 数据流动动画
- 发光边框和阴影
- 渐变色彩搭配
- 玻璃拟态效果
```

### **板块2: 智能策略选股**
**位置**: 导航第二项，专业选股工具
**数据来源**: 学习InStock项目的11种成熟策略

**核心策略（基于InStock）**:
1. **经典价值策略**: PE < 15, PB < 1.5, 市值 > 200亿
2. **放量上涨策略**: 当日成交量/5日均量≥2，成交额≥2亿
3. **均线多头策略**: MA30向上，30日前<20日前<10日前<当日
4. **停机坪策略**: 15日内有涨幅>9.5%，后续3日高开收涨
5. **回踩年线策略**: 突破年线后回踩，伴随缩量
6. **突破平台策略**: 60日内收盘价≥60日均线，放量上涨
7. **海龟交易法则**: 收盘价≥最近60日最高收盘价
8. **高而窄的旗形**: 24-10日前连续两天涨幅≥9.5%
9. **低ATR成长**: 10日最高/最低收盘价≥1.1倍
10. **基本面选股**: PE≤20且>0，PB≤10，ROE≥15%
11. **放量跌停**: 跌>9.5%，成交额≥2亿，量≥5日均量4倍

**大气设计**:
```
策略卡片墙：
- 每个策略独立的大尺寸卡片
- 策略名称大字体展示
- 实时筛选结果数量显示
- 一键筛选，结果表格大气展示
```

### **板块3: 个股AI智能分析**
**功能**: 个股深度分析 + AI智能解读

**核心功能**:
- 股票代码智能搜索（支持拼音、简称）
- 自选股管理（拖拽排序、分组管理）
- 专业指标仪表盘（PE、PB、ROE等）
- AI深度分析（Gemini驱动）
- 分析历史记录和收藏

**大气设计**:
```
分析仪表盘：
- 股票信息大卡片展示
- 关键指标数据可视化
- AI分析结果优雅排版
- 历史分析时间轴展示
```

### **板块4: 量化交易工作台**
**功能**: 策略回测 + 信号分析（专业级工具）

**核心功能详解**:
```
专业回测系统：
- 策略参数可视化调整
- 回测结果图表展示
- 风险指标专业分析
- 信号生成时间轴
```

**大气设计**:
```
专业工作台界面：
- 多屏幕布局（K线图、参数面板、结果展示）
- 专业级图表组件
- 数据密集但层次清晰
- 类似专业交易软件的视觉体验
```

### **板块5: 交易系统（远期功能）**
**功能**: 实际交易执行（未来开发）

**设计预留**:
- 简洁的交易界面
- 风险提示突出显示
- 订单管理清晰明了

## 🎨 **整体设计一致性原则**

### **大气现代化设计语言**
```
视觉层次：
- 大字体标题（32px-48px）
- 充足的留白空间（24px-48px间距）
- 宽松的卡片布局（最小高度200px）
- 统一的圆角规范（16px-24px）

色彩系统：
- 主色调：深空蓝 #0a0e1a
- 辅助色：星云紫 #1a1f2e
- 强调色：科技蓝 #00d4ff
- 渐变色：蓝紫渐变 #00d4ff → #9c27b0
- 文字色：高对比度白色/灰色

动效系统：
- 页面切换：流畅的淡入淡出
- 数据更新：数字滚动动画
- 交互反馈：微妙的缩放和发光
- 加载状态：优雅的骨架屏
```

### **响应式大气布局**
```
桌面端（≥1200px）：
- 全宽度展示，充分利用屏幕空间
- 多栏布局，信息密度适中
- 大尺寸卡片和图表

平板端（768px-1199px）：
- 适度压缩，保持大气感
- 两栏布局为主
- 保持关键信息的突出显示

移动端（<768px）：
- 垂直堆叠，单栏布局
- 保持大字体和充足间距
- 关键信息优先展示
```

### **五板块导航设计**
```
导航布局：
1. 🏠 市场行情      - 首页，市场全景  ← 调整为首页
2. 🎯 策略选股      - InStock成熟策略
3. 🔍 个股AI分析    - 智能分析工具
4. ⚡ 量化工作台    - 专业回测平台
5. 💼 交易系统      - 灰色显示，未开放

导航视觉：
- 大尺寸图标（24px-32px）
- 清晰的文字标签
- 激活状态：发光边框+渐变背景
- 悬停状态：轻微发光和缩放效果
- 禁用状态：灰色+透明度50%
```

## � **开源项目学习策略**

### **量化策略学习来源**
基于我们"小而美"项目定位，很多功能重零开发困难，因此采用学习成熟开源项目的策略：

**推荐学习项目排序**:

1. **InStock** (⭐⭐⭐⭐⭐ 最推荐)
   - **GitHub**: `ethqunzhong/InStock`
   - **学习内容**: 11种选股策略的具体实现逻辑
   - **适合原因**: 策略简单易懂，容易移植到Web环境
   - **应用**: 直接用于板块1的策略实现

2. **qteasy** (⭐⭐⭐⭐)
   - **GitHub**: `shepherdpp/qteasy`
   - **学习内容**: 回测框架设计思路
   - **适合原因**: 轻量级，专注策略回测
   - **应用**: 用于板块3的回测功能设计

3. **ai_quant_trade** (⭐⭐⭐)
   - **GitHub**: `charliedream1/ai_quant_trade`
   - **学习内容**: 整体架构设计思路
   - **适合原因**: 功能全面，有教程
   - **应用**: 参考其模块划分方式

**学习重点**:
```
从InStock学习：选股策略算法（核心）
从qteasy学习：回测框架设计
从ai_quant_trade学习：整体架构思路
```

**重要说明**:
- 学习策略**逻辑**，不是技术实现
- InStock基于akshare在本地环境稳定
- 我们用**东方财富API**替代akshare
- 策略计算逻辑保持一致

## �🔄 **数据更新策略**

### **实时分析实现方案**
```
实时分析流程：
1. 用户查询股票 →
2. 从数据库读取最新数据 →
3. 实时计算技术指标 →
4. 返回分析结果

技术实现：
- 前端：React + ECharts图表
- 后端：Supabase实时查询
- 计算：JavaScript实时计算指标
```

### **定时更新方案**
```
每日19:00 → Supabase定时任务 → 调用东方财富API → 更新当日数据
```

### **数据生命周期**
- **热数据**: 最近30天，完整指标（Supabase）
- **温数据**: 3-12个月历史数据（备用方案）
- **冷数据**: 1年以上历史数据（压缩存储）

## � **数据存储方案（分阶段）**

### **方案A：保守稳妥（推荐当前使用）**
```
全程使用Supabase
- 前6个月：免费版（500MB数据库）
- 6个月后：付费版$25/月
- 优势：零维护，专业稳定
- 成本：第一年约$150
- 技术要求：无
```

**数据量估算**:
```
A股5000只股票 × 30天 × 每条记录约200字节 = 30MB/月
用户数据（1000用户）× 自选股等 = 5MB/月
AI分析记录 = 10MB/月
总计：约45MB/月（远低于500MB免费额度）
```

### **方案B：经济实用（中长期备选）**
```
混合架构
- Supabase：核心功能（免费版）
- 腾讯云+宝塔面板：历史数据存储
- 优势：成本低，扩展性好
- 成本：第一年约$120
- 技术要求：需要学习宝塔面板（比Docker简单很多）
```

**宝塔面板说明**:
- **不属于腾讯云**：是第三方软件，类似Windows图形界面
- **安装简单**：可安装在任何Linux服务器（腾讯云、阿里云等）
- **操作简单**：点击式操作，无需命令行
- **学习成本**：比Docker简单100倍，图形化界面

**宝塔 vs Docker 对比**:
```
Docker操作：
$ docker run -d --name mysql -e MYSQL_ROOT_PASSWORD=123456 mysql:8.0
$ docker exec -it mysql mysql -u root -p
$ CREATE DATABASE stock_db;
（还有一堆配置文件要写）

宝塔面板操作：
1. 点击"软件商店"
2. 点击"MySQL"旁边的"安装"
3. 点击"数据库"→"添加数据库"
4. 输入数据库名称，点击"提交"
完成！
```

### **方案C：最经济（远期备选）**
```
完全自建
- 腾讯云服务器+宝塔面板
- 自建PostgreSQL数据库
- 优势：成本最低
- 缺点：需要一定运维能力
- 成本：第一年约$120
```

### **数据分层存储（方案B/C适用）**
```
热数据（Supabase）：
- 最近30天股票数据
- 用户数据、自选股
- AI分析记录
- 大小：约50MB

温数据（云服务器）：
- 3-12个月历史数据
- 策略回测数据
- 大小：约500MB

冷数据（对象存储）：
- 1年以上历史数据
- 压缩存储，按需加载
- 成本：腾讯云COS，几元/月
```

## �🚀 **分阶段实现计划**

### **阶段1: MVP版本（4周）- 大气首页+核心功能**
- [x] 用户认证系统（Supabase Auth）
- [x] 基础数据表创建（7张核心表）
- [ ] **板块1：市场行情首页**
  - [ ] 大气的大盘指数仪表盘
  - [ ] 涨跌幅排行榜展示
  - [ ] 基础财经资讯展示
  - [ ] 科技感粒子流背景
- [ ] **板块2：策略选股**
  - [ ] 2-3种InStock核心策略实现
  - [ ] 大气的策略卡片设计
- [ ] **板块3：个股AI分析**
  - [ ] 基础自选股功能
  - [ ] AI分析功能（含次数限制）
- [ ] 数据存储：Supabase免费版

### **阶段2: 完整版本（8周）- 五板块全面实现**
- [ ] **板块1完善：市场行情**
  - [ ] 实时数据更新机制
  - [ ] 热门概念板块展示
  - [ ] 财经新闻自动抓取
- [ ] **板块2完善：策略选股**
  - [ ] 11种InStock选股策略全部实现
  - [ ] 策略结果大气展示
- [ ] **板块3完善：个股AI分析**
  - [ ] 完整AI分析功能
  - [ ] 专业指标仪表盘
  - [ ] 分析历史记录
- [ ] **板块4：量化工作台**
  - [ ] K线图表集成（ECharts）
  - [ ] 基础技术指标
  - [ ] 简单策略回测
- [ ] 响应式大气设计全面实现
- [ ] 数据存储：评估是否需要升级

### **阶段3: 高级版本（12周）- 专业化提升**
- [ ] **板块4完善：量化工作台**
  - [ ] 专业回测功能（学习qteasy）
  - [ ] 更多技术指标
  - [ ] 策略参数可视化调整
- [ ] **整体优化**
  - [ ] 移动端大气适配
  - [ ] 性能优化
  - [ ] 用户体验细节打磨
- [ ] 数据存储：考虑方案B（混合架构）

### **阶段4: 扩展版本（18周+）- 商业化功能**
- [ ] **板块5：交易系统**
  - [ ] 模拟交易功能
  - [ ] 交易信号生成
- [ ] **商业化功能**
  - [ ] 用户付费体系
  - [ ] 高级AI分析功能
  - [ ] 更复杂的量化策略
- [ ] 数据存储：根据用户规模选择最优方案

## 🔧 **API设计**

### **前端API调用**
```typescript
// 1. 获取策略筛选结果（基于InStock策略）
GET /api/strategies/screen?strategy=value_strategy
GET /api/strategies/screen?strategy=volume_surge
GET /api/strategies/screen?strategy=ma_bullish

// 2. 市场行情API（新增）
GET /api/market/indices              // 获取大盘指数
GET /api/market/gainers?limit=10     // 涨幅榜前10
GET /api/market/losers?limit=10      // 跌幅榜前10
GET /api/market/volume?limit=10      // 成交量榜前10
GET /api/market/sectors              // 热门概念板块

// 3. 财经资讯API（新增）
GET /api/news/latest?limit=20        // 最新财经新闻
GET /api/news/important              // 重要公告
GET /api/news/category?type=policy   // 按类别获取新闻

// 4. 获取股票详情
GET /api/stocks/detail?ticker=000001

// 5. 自选股管理
POST /api/watchlist/add
DELETE /api/watchlist/remove

// 6. 获取技术指标
GET /api/indicators/calculate?ticker=000001&indicators=macd,kdj,rsi
```

### **Supabase Edge Function**
```typescript
// AI分析函数（已实现，含次数限制）
POST /functions/v1/ai-analysis
{
  "ticker": "000001",
  "user_id": "uuid"
}

// 返回格式
{
  "success": true,
  "ticker": "000001",
  "analysis": "AI分析结果文本",
  "stock_info": {
    "price": 12.34,
    "pe_ratio": 15.6,
    "pb_ratio": 1.2
  },
  "remaining_analyses": 9
}
```

## 🔐 **安全与权限**

### **行级安全策略**
- 用户只能访问自己的自选股
- AI分析记录按用户隔离
- 所有敏感操作需要认证
- AI分析次数限制（防止滥用）

### **环境变量**
```
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_key
GEMINI_API_KEY=your_gemini_key
```

## 📈 **成功指标**

### **技术指标**
- 页面加载时间 < 2秒
- API响应时间 < 500ms
- 数据更新成功率 > 99%
- AI分析响应时间 < 10秒

### **用户指标**
- 用户注册转化率 > 20%
- 日活跃用户留存 > 60%
- AI分析使用率 > 40%
- 策略筛选使用率 > 80%

## 🎯 **项目交接说明**

### **给后续AI开发者的说明**
本PRD包含了完整的项目规划，任何AI工具接手时应了解：

1. **项目定位**：个人投资者分析助手，非专业交易系统
2. **技术边界**：日线级分析，无法做高频交易
3. **数据策略**：东方财富API + Supabase存储
4. **学习来源**：InStock策略 + qteasy回测 + ai_quant_trade架构
5. **存储方案**：当前方案A，中长期可考虑方案B
6. **开发环境**：前端本地，后端云端测试

### **当前项目状态检查点**
- [ ] 用户认证系统是否完成？
- [ ] 数据库表结构是否创建？
- [ ] AI分析Edge Function是否部署？
- [ ] 选股策略实现了几种？
- [ ] 数据存储使用哪个方案？

### **下一步优先级**
1. 实现InStock的2-3种核心策略
2. 完善AI分析功能测试
3. 集成ECharts图表组件
4. 建立数据定时更新机制

---

**关键改进点总结**:
1. ✅ 解决了Vercel Python超时问题（用东方财富API）
2. ✅ 采用预处理数据架构（定时更新到数据库）
3. ✅ 明确的分阶段实现计划（4个阶段）
4. ✅ 可控的数据存储成本（方案A/B/C选择）
5. ✅ 清晰的功能模块划分（四板块架构）
6. ✅ 明确的技术边界（能做什么，不能做什么）
7. ✅ 完整的学习策略（InStock等开源项目）
8. ✅ 详细的交接说明（便于AI工具接手）
