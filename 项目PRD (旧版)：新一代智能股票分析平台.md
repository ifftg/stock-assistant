### **项目PRD (最终版)：新一代智能股票分析平台**

**To: Augment**
**From: [你的名字]**
**Date: 2025-08-27**
**Version: 2.0 (Final for Initial Build)**

#### **1.0 项目愿景与目标 (Project Vision & Goal)**

**项目愿景**：打造一个现代化、高性能、安全且用户友好的在线股票分析工具。它将为注册用户提供强大的A股市场策略选股、深度个股分析、交互式图表和个性化自选股管理功能。

**核心目标**：

1. 
2. **用户中心化**：所有功能都围绕已登录的用户展开，数据严格隔离。
3. **数据专业化**：使用 akshare 作为核心A股数据源，保证数据的准确性和时效性。
4. **分析智能化**：集成 Google Gemini Pro 大模型，提供超越传统指标的深度分析。
5. **体验现代化**：构建流畅的单页应用（SPA）体验，实现无刷新交互。
6. **部署云原生**：整个应用通过 GitHub 和 Vercel 实现自动化、持续集成与部署 (CI/CD)。

#### **2.0 核心技术栈 (Core Technology Stack)**

请严格按照以下技术栈进行项目初始化和开发：

- 
- **核心框架**: **Next.js 14+** (使用 App Router 和 TypeScript)
- **数据库 & 用户认证**: **Supabase** (PostgreSQL, Auth, Edge Functions)
- **A股数据源**: **akshare** (通过 Vercel Python Serverless Function 实现)
- **AI分析核心**: **Google Gemini Pro** (通过 Supabase Edge Function 实现)
- **前端样式**: **Tailwind CSS** + **shadcn/ui** (用于快速构建高质量UI组件)
- **K线图库**: **Apache ECharts for React**
- **部署平台**: **Vercel**
- **代码仓库**: **GitHub**

#### **3.0 功能规格详述 (Feature Specifications)**

- 
- **用户故事**: 作为一个新用户，我希望能注册账号；作为一个老用户，我希望能登录和退出，以便管理我个人的自选股列表。
- **需求详述**:
  1. 创建 **/login** 和 **/signup** 页面。
  2. 使用 **Supabase Auth** 的 JS 客户端库实现用户的注册、邮箱验证和登录功能。
  3. 实现 **/dashboard** 主页面的路由保护：未登录用户访问时，应自动重定向到 /login 页面。
  4. 在导航栏提供明显的“登录/注册”和“退出”按钮。

- 
- **用户故事**: 登录后，我希望看到一个清晰、布局合理的仪表盘，让我可以方便地使用所有核心功能。
- **需求详述**:
  1. 采用经典的**左侧边栏 + 右侧主内容区**的布局。
  2. **左侧边栏**：放置标题为 **“A股策略选股”** 的功能模块。
  3. **右侧主内容区**：自上而下分为三个核心区域：
     - 
     - **个股查询区**: 用于输入代码查询单只股票。
     - **我的自选股**: 表格形式，展示用户已添加的自选股。
     - **深度分析区**: 展示K线图和AI分析结果。

- 
- **用户故事**: 我希望能通过点击预设的投资策略，快速筛选出符合条件的A股股票列表。
- **MVP范围说明**: V1.0版本将专注于**全A股市场**的筛选。市场选择（如B股、港股）和板块/行业选择功能，将在未来版本中进行迭代开发。
- **前端界面**:
  1. 在左侧边栏，创建四个独立的、可点击的策略卡片或按钮，分别命名为：
     - **经典价值策略**
     - **高成长潜力策略**
     - **高股息稳健策略**
     - **ROE核心质量策略**
  2. 点击任一策略后，应有加载状态提示，并在右侧主内容区的一个表格中显示筛选结果。
- **后端API与实现**:
  1. 创建一个API Endpoint: **POST /api/screen**，它应是一个 **Vercel Python Serverless Function**。
  2. **高效实现方案**: 为避免超时，该函数必须采用**“先批量获取，再内存筛选”**的模式。具体步骤：
     - **步骤一 (批量获取)**: 使用 akshare 的相关接口（如 ak.stock_zh_a_spot_em()），**一次性**获取全市场A股的实时行情和关键指标，载入一个 Pandas DataFrame。
     - **步骤二 (内存筛选)**: 使用 pandas 库，根据请求传入的策略名称，在内存中对该DataFrame进行**极速多条件筛选**。
     - **步骤三 (返回结果)**: 将筛选后的结果（股票代码、名称、最新价及策略相关指标）格式化为JSON数组并返回。
- **策略筛选逻辑详述**:
  1. **经典价值策略**:
     - 
     - 市盈率 (PE TTM) < 15
     - 市净率 (PB) < 1.5
     - 总市值 > 200亿
  2. **高成长潜力策略**:
     - 
     - 营业收入同比增长率 > 25%
     - 净利润同比增长率 > 25%
     - 市销率 (PS TTM) < 10
  3. **高股息稳健策略**:
     - 
     - 股息率 (TTM) > 4%
     - 资产负债率 < 60%
     - 股利支付率 < 70%
  4. **ROE核心质量策略**:
     - 
     - 净资产收益率 (ROE, TTM) > 15%
     - 毛利率 > 30%
     - 上市时间 > 5年

- 
- **用户故事**: 当我查询或点击一只股票后，我希望能看到它的详细K线图、技术指标，并能让AI对它进行分析。
- **需求详述**:
  1. 
  2. **数据获取**: 创建一个 **GET /api/stock-data?ticker=[代码]** 的API (Vercel Python Serverless Function)，用于获取指定股票的日K线历史数据和实时报价。
  3. **K线图展示**:
     - 
     - 使用 **Apache ECharts for React** 绘制专业的K线图，并包含成交量图。
     - 默认叠加MA5, MA10, MA20三条移动平均线。
     - 提供**“全屏”**按钮，点击后K线图以模态框形式放大。
  4. **AI智能分析**:
     - 
     - 设置一个**“Gemini智能分析”**按钮。
     - 点击该按钮时，前端调用一个 **Supabase Edge Function**。
     - 该函数负责接收股票代码，安全地从后台调用 akshare 获取该股的基本面数据和近期新闻，整合信息形成Prompt，发送给 **Google Gemini Pro API**。
     - 将 Gemini 返回的分析结果以流式文本的形式展示在前端。

- 
- **用户故事**: 我希望能将感兴趣的股票添加到一个“自选列表”中，随时查看它们的最新动态，并能随时移除。
- **需求详述**:
  1. 
  2. **添加**: 在任何显示个股信息的地方，提供一个“+ 添加自选”按钮。点击后，使用 Supabase JS 客户端将该股票代码写入 watchlists 表。
  3. **展示**: “我的自选股”表格，在页面加载时自动从 watchlists 表中读取属于**当前登录用户**的股票列表。
  4. **移除**: 表格每一行提供一个“移除”按钮，点击后从数据库中删除对应条目。
  5. 所有增删操作，前端界面都应**立即响应**（乐观更新），无需刷新页面。

#### **4.0 数据库设计 (Database Schema)**

- 
- **数据表**: watchlists
- **列定义**: id (主键), user_id (外键), ticker (股票代码), created_at (添加时间)。
- **安全策略**: 必须配置并启用**行级安全策略 (RLS)**，确保用户只能访问和操作自己的数据。

#### **5.0 环境变量与部署 (Environment & Deployment)**

- 
- **本地开发**: 项目根目录需包含一个 .env.local 文件，用于存储 NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY, GOOGLE_API_KEY。
- **线上部署**: 以上所有密钥都必须在 **Vercel 项目的 Environment Variables** 设置中进行配置。代码中不允许硬编码任何密钥。
- **持续部署**: 项目应配置为，当 main 分支有新的代码 push 到 GitHub 时，Vercel 自动触发新的构建和部署流程。